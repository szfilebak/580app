<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <script src="../js/mui.min.js"></script>
    <link href="../css/mui.css" rel="stylesheet"/>
	<link rel="stylesheet" href="../css/style.css">
	<!--标准mui.css-->
	<link rel="stylesheet" href="../css/mui.min.css">		
	<link rel="stylesheet" href="../css2/oil.css">
   
<style>
body {
	html,
	body {
		background-color: #efeff4;
		font-size: 15px;
		color: #6d6d72;
	}
	.title {
		padding: 20px 15px 10px;
		color: #6d6d72;
		font-size: 15px;
		background-color: #fff;
	}
	#hqList{
		background-color: #efeff4;
	}
	.arrow-bottom{ 
	width: 0;
	height: 0;
	border-left: 12px dashed transparent;
	border-right: 12px dashed transparent;
	/*background-color:#32aec6 ;*/
	border-top: 15px solid #32aec6;
	font-sie: 0;
	margin-left: 30px;
	}


</style>
</head>
<body>
	<!--<header class="mui-bar mui-bar-nav" style="height: 44px;background-color: #32aec6;">
		<a id="page" style="font-size: 15px;line-height: 27px;" class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left">返回</a>
		<h1 id="title" class="mui-title" style="color: #000000;font-size: 13px;">他人的工资</h1>
	</header>-->
		<nav id="pbar" class="mui-bar mui-bar-tab" style="background-color: rgb(50, 174, 198);">
			<!--<a id="pager" class="mui-tab-item mui-active" href="#tabbar">
				<span class="mui-icon mui-icon-home"></span>
				<span class="mui-tab-label">首页</span>
			</a>-->
			<a id="GongziCL" class="mui-tab-item" href="#popAddCard">
				<!--<span class="mui-icon mui-icon-contact"></span>-->
				<span class="mui-tab-label" style="color: white;font-size: 16px;">若有错漏点击这里...</span><span class="mui-tab-label mui-icon mui-icon-forward" style="padding-left:20px;color: white;"></span>
			</a>
			<!--<a class="mui-tab-item" href="#tabbar-with-map">
				<span class="mui-icon mui-icon-chatboxes"></span>
				<span class="mui-tab-label">关于我们</span>
			</a>-->
		</nav>	
		<div class="arrow-bottom">	</div>	
		<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
			<div class="mui-scroll">

				<ul id='hqList' class="mui-table-view mui-table-view-chevron" >
									<!--<ul id='hqList' class="mui-table-view mui-table-view-chevron" style="margin: 10px 0;">-->

					<!--<li id="xiaohua" class="" style="background-color: #EEEEEE;padding: 10px;border: none;">
						<div class="divddd"><span style="margin-left: 40%; color: white;background-color: #AAAAAA;border-radius:2px;"> F65987416</span></div>
						<div style="background-color: #FFFFFF;margin: 10px 10px;padding:10px;border-radius:5px;">
							<div style="font-size: 16px;"><b>实发工资</b></div>
							<div>09月04日</div>
							<div style="text-align:center;"><span style="font-size: 20px;"><b>2500</b></span>元</div>
							<br />
				        <div><b><b>出勤天数</b>：</b>28.5天</div>
					        <div><b>正常加班：</b>60小时</div>
					        <div><b>周末加班：</b>10小时</div>
					        <div><b>节日加班：</b>6小时</div>	        
					        <div><b>旷工：</b>2.5天</div>
					        <div><b>迟到早退：</b>6次</div>
					        <div><b>基本工资：</b>1840元</div>
					        <div><b>加班工资：</b>1840元</div>
					        <div><b>工龄工资：</b>1000元</div>
					        <div><b>伙食补贴：</b>340元</div>
					        <div><b>夜班补贴：</b>340元</div>
					        <div><b>住房补贴：</b>340元</div>
					        <div><b>伙食补贴：</b>340元</div>
					        <div><b>奖金：</b>340元</div>
					        <div><b>扣缴社保：</b>240元</div>
				   	        <div><b>扣违纪金：</b>600元</div>
					        <div><b>应发总额：</b>3340元</div>
					        <div><b>实发总额：</b>3340元</div>							
						</div>
				
					</li>
					<li id="" class="" style="background-color: #EEEEEE;padding: 10px;border: none;">
						<div class="divddd"><span style="margin-left: 40%; color: white;background-color: #AAAAAA;border-radius:2px;"> F65987416</span></div>
						<div style="background-color: #FFFFFF;margin: 10px 10px;padding:10px;border-radius:3px;">
							<div style="font-size: 14px;float: left;"><b>实发工资</b></div>
							<div style="font-size: 14px;float: right;"><b>张**</b></div>

							<br />
						<div>09月04日</div>
							<div style="text-align:center;"><span style="font-size: 20px;"><b>2500</b></span>元</div>
							<br />
					        <div><b><b>出勤天数</b>：</b>28.5天</div>
					        <div><b>正常加班：</b>60小时</div>
					        <div><b>周末加班：</b>10小时</div>
					        <div><b>节日加班：</b>6小时</div>	        
					        <div><b>旷工：</b>2.5天</div>
					        <div><b>迟到早退：</b>6次</div>
					        <div><b>基本工资：</b>1840元</div>
					        <div><b>加班工资：</b>1840元</div>
					        <div><b>工龄工资：</b>1000元</div>
					        <div><b>伙食补贴：</b>340元</div>
					        <div><b>夜班补贴：</b>340元</div>
					        <div><b>住房补贴：</b>340元</div>
					        <div><b>伙食补贴：</b>340元</div>
					        <div><b>奖金：</b>340元</div>
					        <div><b>扣缴社保：</b>240元</div>
				   	        <div><b>扣违纪金：</b>600元</div>
					        <div><b>应发总额：</b>3340元</div>
					        <div><b>实发总额：</b>3340元</div>							
						</div>
				
					</li>					-->
			
				</ul>
			</div>
		</div>
		
<!-- start of 错漏弹窗 -->
<div id="popAddCard" class="mui-popover pop_confirm pop_addCard " style="display: none;width: 350px;">
	<div class="hd">填写后提交</div>
	<div class="bd">
		<ul class="mui-table-view">
			<!--<li class="mui-table-view-cell noClick">加油卡类型</li>-->
			<li class="mui-input-row">
							<br />
				<label style="width:30%">上班企业：</label>
				<input style="width: 70%;" id="inputFactoryName" type="text" placeholder="...填写上班的厂名" maxlength="19" value="">

			</li>

			<li class="mui-input-row">
				<label style="width:30%">身份证号：</label>
				<input style="width: 70%;" id="cardId" type="text" placeholder="..." maxlength="19" value="">

			</li>
			<li class="mui-input-row">
				<label style="width:30%">错漏内容：</label>
				<textarea id="front_ask_content" name="front_ask_content" style="float: left; width: 70%;height:50px;background-color:transparent;font-size: 12px;" placeholder="...尽量写清楚，准确。" rows="3" maxlength="200"></textarea>

			</li>
			<li class="mui-table-view-cell noClick">
				<!-- 文本框输入满19位才显示 -->
				<p class="name">注意：<span id="owner">办理期限1周，站里消息回复。</span></p>
				<!-- 自动匹配加油卡持卡人姓名 -->
			</li>
			<br />
		</ul>
	</div>
	<div class="fd fd2 clearfix">
		<a href="http://127.0.0.1:8020/20160605_kcnzq/pages/oil/oilCard.html#popAddCard" class="mui-btn mui-btn-block">取消</a>
		<button id="submitAddCardBtn" class="mui-btn mui-btn-block">提交</button>
	</div>
</div>
<!-- end of 提问弹窗 -->		
	<script type="text/javascript" charset="utf-8">
		mui.init({
			swipeBack: false,
			pullRefresh: {
				container: '#pullrefresh',
				down: {
					callback: pulldownRefresh
				},
				up: {
					contentrefresh: '正在加载...',
					callback: pullupRefresh
				}
			}
		}); //init end		
		mui.plusReady(function () {
		})
		
		//添加newId自定义事件监听
		window.addEventListener('factoriesId',function(event){
			 //获得事件参数
	     	 var factoriesId = event.detail.factoriesId;
	     	 var factories_name = event.detail.factoriesName
	     	 console.log('bierenGongzhi-detail.html；//添加newId自定义事件监听=='+factories_name);
	      	 console.log('factoriesId==='+factoriesId);
			
			var pageNo = 1;
	//		var factoriesList = {};
	        var _url = 'https://app.dagong580.cn/Jsonapi/gongzhiFactories?apikey=5f4cb6c57748665ec03c4afb4e4deae4&page=1&factoriesId='+factoriesId;
	        console.log('_url=='+_url);
			//获取某厂工资列表
			ajaxGongZhiFactrories(factoriesId,_url);			
 		}); //window.addEventListener

		function ajaxGongZhiFactrories(factoriesId,_url){
			
			mui.ajax(_url,{
				dataType:'json',
				async:'false',
				type:'get',
				timeout:10000,
				success:function(data){		
					console.log("chat.html;datap;112:"+JSON.stringify(data));
					console.log("chat.html;data;p113:"+JSON.stringify(data.result));
					var page = data.result.pageEmg.page;	
					var qty = data.result.pageEmg.qty;	
					 gongzhiList=data.result.gongzhiList;
					 console.log('gongzhiList'+gongzhiList);
					 console.log(gongzhiList[0]);
					 
					var list=document.getElementById("hqList");
					var finallist='';
					
		  			for(i=gongzhiList.length-1;i>=0;i--){finallist=finallist+'<li data-id="'+i+'" style="background-color: #EEEEEE;padding: 10px;border: none;"><div class="divddd"><span style="margin-left: 40%; color: white;background-color: #AAAAAA;">'+gongzhiList[i].gongzhi_id+'</span></div><div style="background-color: #FFFFFF;margin: 10px 10px;padding:10px;border-radius:3px;"><div style="font-size: 14px;float: left;"><b>实发工资</b></div><div style="font-size: 14px;float: right;"><b>'+gongzhiList[i].user_t_name+'</b></div><br /><div>'+gongzhiList[i].nianfen+'年'+gongzhiList[i].yuefen+'月</div><div style="text-align:center;"><span style="font-size: 20px;"><b>'+gongzhiList[i].shifagongzhi+'</b></span>元</div><br /><div><b><b>应发工资</b>：</b>'+gongzhiList[i].yingfagongzhi+'元</div><div><b>总工时：</b>'+gongzhiList[i].zhonggongshi+'小时</div><div><b>工时单价：</b>'+gongzhiList[i].gongzhidanjia+'元</div><div><b>水电费：</b>'+gongzhiList[i].shuidianfei+'元</div><div><b>伙食费：</b>'+gongzhiList[i].huoshifei+'元</div><div><b>保险：</b>'+gongzhiList[i].baoxian+'元</div><div><b>其它：</b>'+gongzhiList[i].other+'元</div></div></li>';}  			
					list.innerHTML=finallist;
					
			document.getElementById("hqList").setAttribute("factoriesId",factoriesId);
			document.getElementById("hqList").setAttribute("page",page);
			document.getElementById("hqList").setAttribute("length",gongzhiList.length);
			
			
				}, 
				error: function(xhr, type, errorThrown) { //失败，打一下失败的类型，主要用于调试和用户体验
					console.log('pppp');
					console.log('AJAX:ERR-|T:'+type+'|错误文本:'+xhr.responseText);
					if(type == 'timeout') {
						mui.toast("请求超时：请检查网络")
					} else {
						mui.toast('请求失败：' + type + '\n err:' + errorThrown);
					}
				},     				
			}) //AJAX END				
		}


		/**
		 * 下拉刷新具体业务实现
		 */
		function pulldownRefresh() {
			setTimeout(function() {
				var factoriesId = document.getElementById('hqList').getAttribute('factoriesId');
				console.log('baierenGongzhi-detail.html;L257;factoriesId==='+factoriesId);
				var 	page = document.getElementById("hqList").getAttribute("page");
				console.log(page);
				if(page>=2){
					page--;
				}else{
					page=1
				}
		        var _url = 'https://app.dagong580.cn/Jsonapi/gongzhiFactories?apikey=5f4cb6c57748665ec03c4afb4e4deae4&page='+page+'&factoriesId='+factoriesId;					
				ajaxGongZhiFactrories(factoriesId,_url);
			mui('#pullrefresh').pullRefresh().endPulldownToRefresh(); //refresh completed
			mui('#pullrefresh').pullRefresh().refresh(true);
			}, 1000);
		}; //下拉刷新 end

		//初始化scroll控件：
//		mui('.mui-scroll-wrapper').scroll({
//			deceleration: 0.0005 //flick 减速系数，系数越大，滚动速度越慢，滚动距离越小，默认值0.0006
//		});		
		
		/**
		 * 上拉加载具体业务实现
		 */
		function pullupRefresh() {
			setTimeout(function() {
				var factoriesId = document.getElementById("hqList").getAttribute("factoriesId");
				var 	page = document.getElementById("hqList").getAttribute("page");
				    page++;
				var 	lengthGongzhi = document.getElementById("hqList").getAttribute("length");
				console.log('lengthGongzhi===='+lengthGongzhi);
				console.log('page===='+page);
				
				mui('#pullrefresh').pullRefresh().endPullupToRefresh((lengthGongzhi < 10)); //参数为true代表没有更多数据了。
				
		        var _url = 'https://app.dagong580.cn/Jsonapi/gongzhiFactories?apikey=5f4cb6c57748665ec03c4afb4e4deae4&page='+page+'&factoriesId='+factoriesId;					
				ajaxGongZhiFactrories(factoriesId,_url);	

			}, 1000);
				//快速回滚到该区域顶部
//				mui('.mui-scroll-wrapper').scroll().scrollTo(0,0,100);//100毫秒滚动到顶		
		}; //上拉加载end
		mui.plusReady(function () {
	//错漏报告 AJAX
  	  var _token = localStorage.getItem('$token');
  	  console.log(_token);
  	   _token = JSON.parse(_token);
	  console.log(_token);
	  var chuolouGongzhi = document.getElementById('submitAddCardBtn');
//	  var _phone = localStorage.getItem('user_phone');
	  
	  chuolouGongzhi.addEventListener('tap',function(){
		var FactoryName = document.getElementById('inputFactoryName').value;
    	    var cardId = document.getElementById('cardId').value;
	    var front_ask_content = document.getElementById('front_ask_content').value;
	    var factoriesId = document.getElementById('hqList').getAttribute('factoriesId');
	    
	  	var _url = 'https://app.dagong580.cn/Jsonapi/addGongzhiAsk?apikey=5f4cb6c57748665ec03c4afb4e4deae4';
	  	var my_data = {
			front_ask_content:front_ask_content,
			cardId:cardId,	
	  		user_token:_token.user_token,
			factories_id:factoriesId,
			myfactry:FactoryName
	  	};
	  	console.log(_token.user_token);
	  	mui.ajax(_url,{
			async: false, //同步
			crossDomain: true, //跨域开关
			xhrFiedlds: {
				withCredentials: true
			},     
	  		data:my_data,
            dataType: 'json', 
            type: 'POST', 
            	processData: false,//禁用序列化
            timeout: 10000, 
	     	beforeSend:function() { // 发送之前，可以打一下看看提交的参数（如果是变量）
	     		console.log('beforesend!' + JSON.stringify(my_data))
				plus.nativeUI.closeWaiting(); 
	      	},                   
            success: function(data) { 
            	console.log('------------------------------');
            	console.log(JSON.stringify(data));
            	            console.log(data.status); 

            console.log('上传成功'); 
            
                alert(data.msg);

			mui('.mui-popover').popover('hide'); 
            }, 
            error: function(xhr, type, errorThrown) { 
                mui('.mui-popover').popover('hide');               
                mui.toast('网络异常，请稍后再试！');
            } 
        });  //ajax end 	  	
	
	  }); //event end		
	});
		
	</script>		
		

</body>

</html>